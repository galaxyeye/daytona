# Docker Compose 配置用于本地构建和测试镜像
# 使用方法: docker-compose -f docker-compose.build-local.yaml build

name: daytona-build-local
services:
  # 主 API 服务
  api:
    build:
      context: ../../
      dockerfile: docker/Dockerfile
      target: daytona
      args:
        VERSION: ${VERSION:-0.0.1}
        PUBLIC_WEB_URL: ${PUBLIC_WEB_URL:-http://localhost:3000}
        PUBLIC_ALGOLIA_APP_ID: ${PUBLIC_ALGOLIA_APP_ID:-}
        PUBLIC_ALGOLIA_API_KEY: ${PUBLIC_ALGOLIA_API_KEY:-}
    image: ${REGISTRY:-daytona}/daytona-api:${VERSION:-0.0.1}

  # 代理服务
  proxy:
    build:
      context: ../../
      dockerfile: docker/Dockerfile
      target: proxy
      args:
        VERSION: ${VERSION:-0.0.1}
    image: ${REGISTRY:-daytona}/daytona-proxy:${VERSION:-0.0.1}
    
  # 运行器服务
  runner:
    build:
      context: ../../
      dockerfile: docker/Dockerfile
      target: runner
      args:
        VERSION: ${VERSION:-0.0.1}
    image: ${REGISTRY:-daytona}/daytona-runner:${VERSION:-0.0.1}
    
  # 文档服务
  docs:
    build:
      context: ../../
      dockerfile: docker/Dockerfile
      target: docs
      args:
        VERSION: ${VERSION:-0.0.1}
    image: ${REGISTRY:-daytona}/daytona-docs:${VERSION:-0.0.1}
